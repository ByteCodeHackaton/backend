# DepTrans API Service

## Назначение

- API функционал сервера, работа с данными сотрудников, пассажиров.

## Api

- [ ] [metod post /employee/set](Метод регистрации нового сотрудника метрополитена)
- [ ] [metod post /employee/update](Метод изменения информации о сотруднике)
- [ ] [metod get  /employee/list](Метод получения списка всех сотрудников, работающих по заявкам)
- [ ] [metod post /passenger/set](Метод регистрации нового пассажира)
- [ ] [metod post /passenger/update](Метод изменения информации о пассажире)
- [ ] [metod get  /passenger/list](Метод получения списка всех зарегистрированных пассажиров)
- [ ] [metod get  /passenger](Метод поиска пассажира по ФИО или по номеру телефона)
- [ ] [metod post /category/set](Метод создания новой категории пассажиров)
- [ ] [metod get  /category/list](Метод получения списка всех всех категорий пассажиров для выбора при заполнении заявки)
- [ ] [metod get  /uchastok/list](Метод получения списка всех участков обслуживания сотрудниками)
- [ ] [metod get  /rank/list](Метод получения списка всех должностей сотрудников)
- [ ] [metod get  /account](Метод получения Id сотрудника при запросе по логину и паролю)
- [ ] [metod get  /account/exist](Метод проверки логина на уникальность, сужществует или нет такой логин в БД)

## Зависимости

You will need to get the following packages to make it work:

```go
go get -u github.com/lib/pq
go get -u github.com/gorilla/mux
go get -u modernc.org/sqlite
go get -u github.com/samborkent/uuidv7
go get -u github.com/rs/cors
go get -u golang.org/x/crypto/blake2b
```

## Методы

### /employee/set

на входе 1 параметр и json в body:

```txt
.../employee/set?id=018fe832-eb8f-7d95-b1d3-e22306c5bf33
```

```json
{
    "date": "25.04.2024",
    "time_work": "20:00-08:00",
    "fio": "Тестовых В.И.",
    "uchastok": "018fe823-9419-7fe0-a8cb-19db345ec1ac",
    "smena": "2Н",
    "rank": "ЦИ",
    "sex": "Мужской",
    "phone_work": "84959112233",
    "phone_personal": "89119876543",
    "tab_number": "46573645",
    "type_work": "лёгкая работа"
}
```

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "message": "Добавлен сотрудник: Тестовый В.И."
    }
}
```

при повторном добавлении сотрудника статус 417 и ошибка:

```txt
Ошибка добавления сотрудника: constraint failed: UNIQUE constraint failed: employees.id (1555)
```

--------------------------------------------

### /employee/list

входные параметры:
limit - ограничение выборки (по умолчанию 20 записей)
off -  смещение выборки (по умолчанию 0)

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "details": [
              {
                "date": "23.04.2024",
                "time_work": "20:00-08:00",
                "id": "018fee07-b2d2-7eff-8e2e-c140187a569b",
                "fio": "Болотов Г.Е.",
                "uchastok": "ЦУ-3 (Н)",
                "smena": "2Н",
                "rank": "ЦСИ",
                "sex": "Мужской",
                "phone_work": "",
                "phone_personal": "",
                "tab_number": "",
                "type_work": ""
            },
            {
                "date": "23.04.2024",
                "time_work": "20:00-08:00",
                "id": "018fee07-b3b1-7f37-b8be-079ffbfd136e",
                "fio": "Шварева М.В.",
                "uchastok": "ЦУ-3 (Н)",
                "smena": "2Н",
                "rank": "ЦСИ",
                "sex": "Женский",
                "phone_work": "",
                "phone_personal": "",
                "tab_number": "",
                "type_work": ""
            }
        ]
    }
}
```

--------------------------------------------

### /passenger/set

на входе:

```json
{
    "id": "018fe832-eb8f-7d95-b1d3-e22306c5bf23",
    "fio": "Пассажиркин П.П.",
    "phone": "79871234567",
    "category": "018fe832-ed6a-7150-8aae-cc3596b17ec9",
    "sex": "Мужской",
    "description": "",
    "eks": 0
}
```

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "state": "018fe866-ecc1-7ee5-90d6-7f6c84b1d4a1",
        "message": "Добавлен пассажир: Пассажиркин П.П."
    }
}
```

при повторном добавлении пассажира статус 417 и ошибка:

```txt
Ошибка добавления пассажира: constraint failed: UNIQUE constraint failed: passengers.fio, passengers.phone (2067)
```

--------------------------------------------

### /passenger/update

входные параметры:

id - уникальный идентификатор пассажира
и json в body:

```json
{
    "id": "018fe832-eb8f-7d95-b1d3-e22306c5bf23",
    "fio": "Пассажиркин П.П.",
    "phone": "79871234567",
    "category": "018fe832-ed6a-7150-8aae-cc3596b17ec9",
    "sex": "Мужской",
    "description": "",
    "eks": 0
}
```

на выходе при успешном выполнении статус 200 и json:

```json
{
    "id": "018fe864-84b3-7656-a270-6a57f43821c4"
}
```
где id - уникальный идентификатор пассажира

при попытке изменить ФИО или телефон пассажира на ФИО или телефон, уже имеющиеся в БД, будет статус 417 и ошибка:

```txt
Ошибка изменения информации о пассажире: constraint failed: UNIQUE constraint failed: passengers.fio, passengers.phone (2067)
```

--------------------------------------------

### /passenger/list

входных параметров нет

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "details": [
            {
                "id": "018fe864-84b3-7656-a270-6a57f43821c4",
                "fio": "Пассажиров П.П.",
                "phone": "79871234567",
                "category": "018fe832-ed6a-7150-8aae-cc3596b17ec9",
                "sex": "Мужской",
                "eks": 0
            },
            {
                "id": "018fe866-ecc1-7ee5-90d6-7f6c84b1d4a1",
                "fio": "Пассажиркин П.П.",
                "phone": "79871234567",
                "category": "018fe832-ed6a-7150-8aae-cc3596b17ec9",
                "sex": "Мужской",
                "description": "Дополнительная информация",
                "eks": 0
            }
        ]
    }
}
```

--------------------------------------------

### /passenger

входные параметры:
fio - ФИО пассажира
и/или
phone - телефон пассажира

на выходе при успешном выполнении статус 200 и json:

```json
{
    "id": "018fe864-84b3-7656-a270-6a57f43821c4",
    "fio": "Пассажиров П.П.",
    "phone": "79871234567",
    "category": "018fe832-ed6a-7150-8aae-cc3596b17ec9",
    "sex": "Мужской",
    "description": "",
    "eks": 0
}
```

если пассажир не найден в бд статус 417 и ошибка:

```txt
Нет такого пассажира в БД: sql: no rows in result set
```

--------------------------------------------

### /category/set

входные параметры:
cat - наименование категории пассажиров

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "state": "018fe8e5-6b4c-7e88-a0b6-0f200e209ba7",
        "message": "Добавлена категория пассажиров: Наименование категории пассажиров"
    }
}
```

при повторном добавлении одного и того же пассажира статус 417 и ошибка:

```txt
Ошибка добавления категории пассажиров: constraint failed: UNIQUE constraint failed: category_dictionary.category (2067)
```

--------------------------------------------

### /category/list

входных параметров нет

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "details": [
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b11ec9",
                "category": "ИЗТ – Инвалид по зрению (тотальный, сопровождение по метрополитену)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b12ec9",
                "category": "ИЗ – Инвалид по зрению с остаточным зрением (слабовидящий, сопровождение по метрополитену)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b13ec9",
                "category": "ИС – Инвалид по слуху (в основном помощь в ориентировании)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b14ec9",
                "category": "ИК – Инвалид колясочник (передвижение в инвалидной коляске)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b15ec9",
                "category": "ИО – Инвалид опорник (необходима поддержка при передвижении и/или на лестницах/эскалаторах)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b16ec9",
                "category": "ДИ – Ребенок инвалид (зачастую передвижение в инвалидной коляске)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b17ec9",
                "category": "ПЛ – Пожилой человек (необходима поддержка при передвижении и/или на лестницах/эскалаторах)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b18ec9",
                "category": "РД – Родители с детьми (сопровождение ребенка)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b19ec9",
                "category": "РДК – Родители с детскими колясками (помощь с детской коляской)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b20ec9",
                "category": "ОГД – Организованные группы детей (сопровождение по метрополитену)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b21ec9",
                "category": "ОВ – Временно маломобильные (после операции, переломы и прочее)"
            },
            {
                "id": "018fe832-ed6a-7150-8aae-cc3596b22ec9",
                "category": "ИУ – Люди с ментальной инвалидностью"
            },
            {
                "id": "018fe8e5-6b4c-7e88-a0b6-0f200e209ba7",
                "category": "Наименование категории пассажиров"
            }
        ]
    }
}
```

--------------------------------------------

### /uchastok/list

входных параметров нет

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "details": [
            {
                "id": "018fe822-8929-7491-a897-e960f85d78fe",
                "uchastok": "ЦУ-3 (Н)"
            },
            {
                "id": "018fe823-68f8-781e-ac9b-5223c8c5f1d1",
                "uchastok": "ЦУ-4 (Н)"
            },
            {
                "id": "018fe823-7156-73c8-9c1a-c1f2a98fa72e",
                "uchastok": "ЦУ-2"
            },
            {
                "id": "018fe823-7bea-78fb-853c-eee11bfab2ae",
                "uchastok": "ЦУ-1"
            },
            {
                "id": "018fe823-84d5-7327-bf76-21ef41682534",
                "uchastok": "ЦУ-8"
            },
            {
                "id": "018fe823-8bc0-751c-a0aa-02fec47656e1",
                "uchastok": "ЦУ-3"
            },
            {
                "id": "018fe823-9419-7fe0-a8cb-19db323ec1ac",
                "uchastok": "ЦУ-4"
            },
            {
                "id": "018fe823-a158-7f75-96e9-bf36b4aeb76a",
                "uchastok": "ЦУ-5"
            }
        ]
    }
}
```

--------------------------------------------

### /rank/list

входных параметров нет

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "details": [
            {
                "id": "018fed9c-d0f4-7a6c-af67-71bafee99c03",
                "rank": "ЦСИ"
            },
            {
                "id": "018fed9c-d1d6-7dd4-9b63-3a2090a1ad5c",
                "rank": "ЦИ"
            },
            {
                "id": "018fed9c-d2cd-7bc5-a444-bdcb0e6280c0",
                "rank": "ЦУ"
            }
        ]
    }
}
```

--------------------------------------------

### /account

входные параметры:

login - логин сотрудника (в открытом виде)

pass - пароль сотрудника (в открытом виде)

В БД пароль хранится зашифрованным blake2b

В случае если сотрудник с таким логином и паролем найден в БД тогда на выходе статус 200 и json:

```json
{
    "id": "018fee07-bbfb-7446-aca3-6c0a66505937"
}
```

Если один или оба параметра в запросе не были заданы тогда на выходе статус 400 и ошибка:

```txt
Parameters not found!
```

где id - это уникальный идентификатор сотрудника

Если сотрудник с таким логином и паролем не найден (отсутствует в БД) тогда на выходе статус 417 и ошибка:

```txt
Неверный логин или пароль: sql: no rows in result set
```

Если для найденного в БД сотрудника был указан неверный пароль тогда на выходе статус 417 и ошибка:

```txt
Неверный пароль!
```

--------------------------------------------

### /account/exist

входные параметры:

login - логин сотрудника (в открытом виде)

В случае если такой логин уже существует тогда статус 200 и json:

```json
{
    "id": "018fee07-bbfb-7446-aca3-6c0a66505937"
}
```

где id - это уникальный идентификатор сотрудника

Если параметр в запросе не был задан тогда на выходе статус 400 и ошибка:

```txt
Parameter not found!
```

Если такой логин не найден (отсутствует в БД) тогда на выходе статус 417 и ошибка:

```txt
Указанный логин не найден в БД: sql: no rows in result set
```

--------------------------------------------
