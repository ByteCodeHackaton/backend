# DepTrans API Service

## Назначение

- API функционал сервера, работа с данными сотрудников, пассажиров.

## Api

- [ ] [metod post /employee/set](Метод регистрации нового сотрудника метрополитена)
- [ ] [metod get  /employee/list](Метод получения списка всех сотрудников, работающих по заявкам)
- [ ] [metod post /passenger/set](Метод регистрации нового пассажира)
- [ ] [metod get  /passenger/list](Метод получения списка всех зарегистрированных пассажиров)
- [ ] [metod get  /passenger](Метод поиска пассажира по ФИО или по номеру телефона)

## Зависимости

You will need to get the following packages to make it work:

```go
go get -u github.com/lib/pq
go get -u github.com/gorilla/mux
go get -u modernc.org/sqlite
go get -u github.com/samborkent/uuidv7
```

## Методы

### /employee/set

на входе 1 параметр и json в body:

```txt
.../employee/set?id=018fe832-eb8f-7d95-b1d3-e22306c5bf33
```

```json
{
    "date": "25.04.2024",
    "time_work": "20:00-08:00",
    "fio": "Тестовых В.И.",
    "uchastok": "018fe823-9419-7fe0-a8cb-19db323ec1ac",
    "smena": "2Н",
    "rank": "ЦИ",
    "sex": "Мужской"
}
```

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "message": "Добавлен сотрудник: Тестовый В.И."
    }
}
```

при повторном добавлении сотрудника статус 417 и ошибка:

```txt
Ошибка добавления сотрудника: constraint failed: UNIQUE constraint failed: employees.id (1555)
```

--------------------------------------------

### /employee/list

входных параметров нет

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "details": [
            {
                "date": "24.04.2024",
                "time_work": "08:00-20:00",
                "id": "3",
                "fio": "Белоусова Е,В.",
                "uchastok": "ЦУ-3",
                "smena": "1",
                "rank": "ЦИ",
                "sex": "Женский"
            },
            {
                "date": "24.04.2024",
                "time_work": "07:00-19:00",
                "id": "4",
                "fio": "Жукова Г.Б.",
                "uchastok": "ЦУ-1",
                "smena": "1",
                "rank": "ЦСИ",
                "sex": "Женский"
            }
        ]
    }
}
```

--------------------------------------------

### /passenger/set

на входе:

```json
{
    "id": "018fe832-eb8f-7d95-b1d3-e22306c5bf23",
    "fio": "Пассажиркин П.П.",
    "phone": "79871234567",
    "category": "018fe832-ed6a-7150-8aae-cc3596b17ec9",
    "sex": "Мужской",
    "description": "",
    "eks": 0
}
```

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "state": "018fe866-ecc1-7ee5-90d6-7f6c84b1d4a1",
        "message": "Добавлен пассажир: Пассажиркин П.П."
    }
}
```

при повторном добавлении пассажира статус 417 и ошибка:

```txt
Ошибка добавления пассажира: constraint failed: UNIQUE constraint failed: passengers.fio, passengers.phone (2067)
```

--------------------------------------------

### /passenger/list

входных параметров нет

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "details": [
            {
                "id": "018fe864-84b3-7656-a270-6a57f43821c4",
                "fio": "Пассажиров П.П.",
                "phone": "79871234567",
                "category": "018fe832-ed6a-7150-8aae-cc3596b17ec9",
                "sex": "Мужской",
                "eks": 0
            },
            {
                "id": "018fe866-ecc1-7ee5-90d6-7f6c84b1d4a1",
                "fio": "Пассажиркин П.П.",
                "phone": "79871234567",
                "category": "018fe832-ed6a-7150-8aae-cc3596b17ec9",
                "sex": "Мужской",
                "description": "Дополнительная информация",
                "eks": 0
            }
        ]
    }
}
```

--------------------------------------------

### /passenger

входные параметры:
fio - ФИО пассажира
и/или
phone - телефон пассажира

на выходе при успешном выполнении статус 200 и json:

```json
{
    "id": "018fe864-84b3-7656-a270-6a57f43821c4",
    "fio": "Пассажиров П.П.",
    "phone": "79871234567",
    "category": "018fe832-ed6a-7150-8aae-cc3596b17ec9",
    "sex": "Мужской",
    "description": "",
    "eks": 0
}
```

если пассажир не найден в бд статус 417 и ошибка:

```txt
Нет такого пассажира в БД: sql: no rows in result set
```

--------------------------------------------

### /category/set

входные параметры:
cat - наименование категории пассажиров

на выходе при успешном выполнении статус 200 и json:

```json
{
    "document": {
        "state": "018fe8e5-6b4c-7e88-a0b6-0f200e209ba7",
        "message": "Добавлена категория пассажиров: Наименование категории пассажиров"
    }
}
```

при повторном добавлении одного и того же пассажира статус 417 и ошибка:

```txt
Ошибка добавления категории пассажиров: constraint failed: UNIQUE constraint failed: category_dictionary.category (2067)
```

--------------------------------------------
